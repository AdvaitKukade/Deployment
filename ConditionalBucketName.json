{

  "AWSTemplateFormatVersion" : "2010-09-09",

    

  "Parameters" : {

    "EnvType" : {

      "Description" : "Environment type.",

      "Default" : "dev",

      "Type" : "String",

      "AllowedValues" : ["prod", "dev"],

      "ConstraintDescription" : "must specify prod or dev."

    }

  },

  

  "Conditions" : {

    "CreateDevResources" : {"Fn::Equals" : [{"Ref" : "EnvType"}, "dev"]},

    "CreateProdResources" : {"Fn::Equals" : [{"Ref" : "EnvType"}, "prod"]}

  },

  

  "Resources": {

        "ReactBucketDev": {

            "Type": "AWS::S3::Bucket",

            "Properties": {

                "BucketName": "{{resolve:ssm:bucket-dev:1}}",

                "AccessControl": "PublicReadWrite",

                "WebsiteConfiguration": {

                    "ErrorDocument": "index.html",

                    "IndexDocument": "index.html"

                }

            },

            "Metadata": {

                "AWS::CloudFormation::Designer": {

                    "id": "99ca06c9-395f-4b23-b8eb-4d4a8a12756f"

                }

            }

        },

        

        "ReactBucketProd": {

            "Type": "AWS::S3::Bucket",

            "Properties": {

                "BucketName": "{{resolve:ssm:bucket-prod:1}}",

                "AccessControl": "PublicReadWrite",

                "WebsiteConfiguration": {

                    "ErrorDocument": "index.html",

                    "IndexDocument": "index.html"

                }

            },

            "Metadata": {

                "AWS::CloudFormation::Designer": {

                    "id": "99ca06c9-395f-4b23-b8eb-4d4a8a12756f"

                }

            }

        },

        

        "ReactBucketPolicy": {

            "Type": "AWS::S3::BucketPolicy",

            "Properties": {

                "Bucket": {

                    "Ref": "ReactBucketDev"

                },

                "PolicyDocument": {

                    "Statement": [

                        {

                            "Effect": "Allow",

                            "Action": "s3:GetObject",

                            "Principal": "*",

                            "Resource": [

                                {

                                    "Fn::Join": [

                                        ":",

                                        [

                                            "arn:aws:s3",

                                            "",

                                            "",

                                            "{{resolve:ssm:bucket-dev:1}}/*"

                                        ]

                                    ]

                                }

                            ],

                            "Condition": {

                                "IpAddress": {

                                    "aws:SourceIp": [

                                        "182.76.250.50/24",

                                        "14.141.151.78/24",

                                        "68.129.175.105/24",

                                        "173.56.37.106/24",

                                        "173.68.100.155/24"

                                    ]

                                }

                            }

                        }

                    ]

                }

            },

            "Metadata": {

                "AWS::CloudFormation::Designer": {

                    "id": "cce342c6-6c5c-4324-a81b-0b2a4d54d69f"

                }

            }

        }

    },

    "Metadata": {

        "AWS::CloudFormation::Designer": {

            "99ca06c9-395f-4b23-b8eb-4d4a8a12756f": {

                "size": {

                    "width": 60,

                    "height": 60

                },

                "position": {

                    "x": 60,

                    "y": 90

                },

                "z": 1,

                "embeds": []

            },

            "cce342c6-6c5c-4324-a81b-0b2a4d54d69f": {

                "size": {

                    "width": 60,

                    "height": 60

                },

                "position": {

                    "x": 180,

                    "y": 90

                },

                "z": 1,

                "embeds": [],

                "isassociatedwith": [

                    "99ca06c9-395f-4b23-b8eb-4d4a8a12756f"

                ]

            },

            "4bbc5485-fd9d-43ff-a327-90959f96c589": {

                "size": {

                    "width": 60,

                    "height": 60

                },

                "position": {

                    "x": 60,

                    "y": 10

                },

                "z": 0,

                "embeds": []

            }

        }

    },

    "Outputs" : {

    "BucketNameDev" : {

      "Value" : { "Ref" : "ReactBucketDev" }, 

      "Condition" : "CreateDevResources"

    },

    "BucketNameProd" : {

      "Value" : { "Ref" : "ReactBucketProd" }, 

      "Condition" : "CreateProdResources"

    }

  }

}